2018-06-30

## Redis的阻塞

### 发现阻塞
1. log-Appender组件
1. 修改源码, 输出redis节点的ip与端口
2. redis的监控系统

### 内在原因
1. API或数据结构使用不合理
    - 包含大量元素的hash结构上执行 hgetall
2. CPU饱和
2. 持久化相关阻塞
    - fork阻塞
        - RDB
        - AOF重写
    - AOF刷盘阻塞
        - 一般每秒一次
        - fsync

### 外在原因
1. CPU竞争
    - 进程竞争
    - 绑定CPU
2. 内存交换
    - **把redis使用过的部分内存换出到硬盘**
    - 预防
        - 保证机器充足的可用内存
        - 设置最大可用内存, 防止极端情况下的redis内存不可控的增长
        - 降低系统使用swap优先级???
3. 网络问题
    - 拒绝连接
        - 网络闪断
        - Redis连接拒绝
            - maxClients--默认10000
        - 连接溢出
            - 进程限制
                - 操作系统
                    - ulimit -n
                - redis自身限制
            - backlog队列溢出??
    - 网络延迟
    - 网卡软终中断