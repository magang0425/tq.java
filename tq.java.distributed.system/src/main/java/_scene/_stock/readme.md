2018-12-13

## 库存类问题
1. 库存扣多了
2. 转账问题
    - 出账户和入账户不在同一个服务中
    - 多个账户对同一个账户操作
    
### 1
1. 平常一样编码, 加锁, 
2. 获取数量, 比较, 然后申请扣除
3. 结果
    - 数量最后 正确
    - 但是当设计有 容错机制的时候, 
        - 重试的时候, 就会得到错误数据, 因为库存数据被重复扣除

### 2
1. 将修改库存值改为直接设置
2. 设置库存是一个幂等操作
2. 会发生并发扣除的情况
    - 最后一次设置库存会覆盖和掩盖前一次并发操作
3. 原因
    - 设置操作发生的时候，没有检查库存与查询出来的库存有没有变化
    
### 3
1. 升级为 CAS 模式

### 4 解决ABA
1. 添加version字段, 每次改变 并 修改version