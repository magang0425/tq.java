2018-12-15

## 高可用架构

### 网站可用性度量
1. 多少个9


### 高可用的应用
1. 通过负载均衡进行无状态服务的失效转移
2. 应用服务器集群的 Session 管理
    - Session 复制
        - 并发量大的时候, 导致大量的Session复制通讯
    - Session 绑定
        - 绑定在某台特定的服务器上
        - 不符合高可用的要求
        - 使用 Cookie 记录Session
            - Cookie 大小有限制, 可以记录的信息有限
            - 每次响应都需要传输 Cookie, 影响性能
        - Session服务器
            - 独立部署session服务器, 统一管理session
            - 每次读写session, 都访问 session服务器

### 高可用的服务
1. 分级管理
    - 优先级高的服务单独部署
2. 超时设置
3. 异步调用
4. 服务降级
    - 拒绝服务
        - 降低低优先级的调用
        - 随机拒绝
    - 关闭功能
5. 幂等性设计
    - 重复调用
    - 转账交易
    
### 高可用的数据
1. 数据备份 失效转移
2. CAP原理
    - 高可用的数据
        - 数据持久
        - 数据可访问
        - 数据一致性
    - 数据一致性(Consistency) 数据可用性(Availibility) 分区容忍(Patition Tolerance)
    - 数据一致性
        - 数据强一致
        - 数据用户一致
            - 数据的各个副本可能不一致, 但是终端用户访问的时候, 通过纠错以及校验机制, 返回一个一致且正确的数据给用户
        - 数据最终一致性
            - 物理存储的数据可能不一致
            - 终端用户访问的数据也可能不一致
            - 但系统经过一段时间后, 数据最终会达到一致
3. 数据备份
    - 冷备
        - 简单 廉价 成本与技术较低
        - 不能保证数据最终一致
        - 不能保证数据可用
    - 热备
        - 异步备份 同步备份
4. 失效转移
    - 失效确认
    - 访问转移
    - 数据恢复
    
### 网站运行监控
1. 监控数据采集
    - 用户行为日志收集
        - 服务端日志收集
        - 客户端浏览器日志收集
2. 服务器性能监控
    - 系统load, 内存占用, 磁盘io, 网络io
3. 运行数据报告
    - 缓存命中率, 平均响应延迟时间, 每分钟发送邮件数目, 待处理的任务总数
4. 监控管理
    - 系统报警
        - 报警阈值
    - 失效转移
        - 自动优雅降级