2018-05-14

## 缓存设计


### 缓存的收益与成本(client--cache--db)
1. 收益
    - 加速读写
    - 降低后端负载
2. 成本
    - 数据不一致: 缓存层与存储层存在一定时间窗口的不一致 
    - 代码维护成本
    - 运维成本
3. 使用场景
    - 开销大的操作
    - 加速响应相求
    
### 缓存更新策略
1. LRU/LFU/FIFO 算法剔除
    - 一致性: 只能决定那种算法, 一致性较差
    - 维护成本: 只需要配置最大 maxmemory和对应的策略即可
2. 超时剔除
    - 一致性: 一段时间内不一致
    - 维护成本: 成本不高, 数据应用方允许这段时间的缓存不一致
3. 主动更新
    - 使用场景: 对于数据的一致性要求高, 需要在真实数据更新后, 立即更新缓存数据--利用消息系统或者其他方式通知缓存更新
    - 一致性: 最高, 但**是主动更新发生问题, 这条数据可能长时间不更新, 配合 超时剔除 效果更好**
    - 维护成本: 较高, 需要自己维护
4. 实践
    - 低一致性业务配置 最大内存和淘汰策略
    - 高一致性使用 超时删除和主动更新结合的方式
    
### 缓存粒度
1. 缓存粒度问题是一个容易被忽视的问题， 如果使用不当， 可能会造成很
   多无用空间的浪费， 网络带宽的浪费， 代码通用性较差等情况， 需要综合数
   据**通用性、 空间占用比、 代码维护性**三点进行取舍
   
### 