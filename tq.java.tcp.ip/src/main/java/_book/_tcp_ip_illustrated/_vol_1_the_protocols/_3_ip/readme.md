2018-05-17

## IP

### IP首部

![](https://github.com/t734070824/tq.java/blob/master/tq.java.tcp.ip/src/main/java/_book/_vol_1_the_protocols/_vol_1_the_protocols/_3_ip/1.png?raw=true)

![](https://github.com/t734070824/tq.java/blob/master/tq.java.tcp.ip/src/main/java/_book/_vol_1_the_protocols/_vol_1_the_protocols/_3_ip/2.png?raw=true)

1. 192.168.1.183 --> 192.168.1.133, 数据:2
2. 4位版本号
    - 当前版本为 IPV4: 0100
3. 4位首部长度
    - 首部占32bit的数目
    - 首部最长为60字节: 4位--1111--1+2+4+8--15 * 32bit / 8 --60byte
    - 普通IP数据报(没有任何选择项) 字段的值是 5 : 0101
4. 8位服务类型 TOS
    - 0000 0000
5. 16位总长度(字节数)
    - 整个IP数据报的长度, 以字节为单位
    - 利用首部长度字段和总长度字段，就可以知道 I P数据报中数据内容的起始位置和长度
    - 16bit --最长IP数据报 65535字节
    - 
6. 16位标识
    - 标识字段唯一地标识主机发送的每一份数据报。通常每发送一份报文它的值就会加 1
7. 3位标志
8. 13位片偏移
9. 8位生存时间(TTL)
    - **生存时间字段设置了数据报可以经过的最多路由器数**
    - 一旦经过一个处理它的路由器，它的值就减去 1。当该字段的值为 0时，数据报就被丢弃，并发送 I C M P报文通知源主机
10. 8位协议类型
    - TCP协议--6--0x06
11. 16位首部校验和
    - 根据 I P首部计算的检验和码
    - 计算方式//TODO
12. 32位源IP地址
13. 32位目的IP地址
14. 可选项


### IP 路由选择
1. TODO
2. 路由表
3. 如果目的主机在直接相连的网络上，那么就把
   数据报直接传给目的主机，否则传给默认路由器
4. 在进行路由选择决策时，主机和路由器都使用路由表。在表中有三种类型的路由：特定
   主机型、特定网络型和默认路由型。路由表中的表目具有一定的优先级。在选择路由时，主
   机路由优先于网络路由，最后在没有其他可选路由存在时才选择默认路由。
3. 自己的理解
    - 查看目的IP是否在同一个网络地址上, 相同, 直接传输
    - 不在, 根据路由表查找路由, 一般选择默认路由, 发送给路由
    - 路由同样进行上述操作

### IP 地址 32位?
1. eg: 192.168.0.1
    - 每段最大255 -- byte最大值
    - 一段为 8位
    - 8bit * 4 = 32 bit

### 子网寻址
1. 不把IP地址单纯的看成一个 网络号 和 主机号的组成, 而是把 主机号 在分成一个子网号 和 一个主机号
    - B类地址 140.252, 剩下的16bit中, 8位子网号, 8位主机号 总共 254(子网) * 254(主机)
2. 子网的划分缩小了 Internet 路由表的规模, 

### 



