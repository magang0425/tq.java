2018-03-09

### 概述
1. 对同一个系统，使用同样的条件，一次请求和重复的多次请求对系统资源的影响是一致的。
2. 幂等有两个维度：一是空间维度上的幂等，即幂等对象的范围，是个人还是机构，是某一次交易还是某种类型的交易...
二是时间维度上的幂等，即幂等的保证时间，是几秒、几分钟还是永久性的.

### 幂等的常用思路

#### MVCC
1. 多版本并发控制，乐观锁的一种实现，在数据更新时需要去比较持有数据的版本号，版本号不一致的操作无法成功
2. update blogTable set count= count+1,version=version+1 where id=321 and version=123 
3. 每一个version只有一次执行成功的机会，一旦失败必须重新获取。

#### 去重表
1. 利用数据库表单的特性来实现幂等，常用的一个思路是在表上构建唯一性索引，保证某一类数据一旦执行完毕，后续同样的请求再也无法成功写入

#### TOKEN机制
1. 为每一次操作生成一个唯一性的凭证，也就是token。一个token在操作的每一个阶段只有一次执行权，
一旦执行成功则保存执行结果。对重复的请求，返回同一个结果
2. 记录操作状态, 
3. 保证操作顺序的话, 需要队列支持 
