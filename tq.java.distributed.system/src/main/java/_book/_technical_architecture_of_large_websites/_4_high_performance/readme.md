2018-12-15

## 网站的高性能架构


### 性能优化策略
1. 性能分析
    - 检查请求处理的各个环节的日志
    - 分析那个环节的响应时间不合理, 超过预期
    - 检查监控数据. 分析影响性能的主要因素是
        - 内存, 磁盘, 网络, CPU
        - 代码问题还是架构不合理
        - 系统资源确实不足
         
### 性能优化
1. Web前端性能优化
    - 减少HTTP缓存
        - 合并请求
    - 使用浏览器缓存
    - 启用压缩
    - 减少Cookie 传输
    - CDN加速
    - 反向代理
2. 应用服务器优化
    - 分布式缓存
        - 优先考虑使用缓存优化性能
    - 合理使用缓存
        - 不适合
            - 频繁修改的缓存
            - 没有热点的访问
            - 数据不一致与脏读
            - 可用性
        - **缓存不应该当做一个可靠的数据源来使用**
        - 缓存预热
        - 缓存穿透
            - 缓存不存在的数据
    - 分布式缓存架构
        - 集群方式提供缓存服务
        - 架构方式
            - JBoss Cache 更新同步的分布式缓存
            - Memcached 不互相通信的缓存
                - 简单的通信协议
                    - redis 的也简单
                - 丰富的客户端程序
                - 高性能的网络通信
                    - libevent
                - 高效的内存管理
                    - 固定空间分配
                        - 内存空间分为一组slab, 每个slab包含一组chunk, 同一个slab里的每一个chunk的大小是固定的
                        - 拥有相同大小的chunk的slab被组织到一起, 叫做 slab_class
                        - **存储数据的时候,根据数据的size, 需要一个大于size的最小chunk将数据写入**
                        - 优点
                            - 避免内存碎片管理
                            - 内存的分配与释放都以chunk为单位
                            - 采用LRU算法释放最近最久未被访问的数据占用的空间
                        - 问题
                            - 内存浪费
                - 互不通信的服务器集群架构
                    - 满足海量缓存数据的需求
                    - 客户端路由算法一致性hash
    - 异步操作
        - 消息队列
        - **任何可以晚点做的事情都可以晚点做**
    - 使用集群
    - 代码优化
        - 多线程
            - 无状态对象
            - 局部对象
            - 并发访问资源使用锁
        - 资源复用
        - 数据结构
        - 垃圾回收
3. 存储性能优化
    - 磁盘: 机器磁盘 vs SSD
    - B+树 vs LSM 树
    - RAID vs HDFS
    
        
            