2019-03-11

## 主从, sentinel, 集群

### 单例
1. **数据备份和数据体量较大造成的性能降低**

### 主从
1. 每个客户端连接redis实例的时候都是指定了ip和端口号的，如果所连接的redis实例因为故障下线了，
    **而主从模式也没有提供一定的手段通知客户端另外可连接的客户端地址，
    因而需要手动更改客户端配置重新连接**
    
### 集群
1. 解决了redis在分布式方面的需求。
2. 当遇到单机内存，并发和流量瓶颈等问题时，可采用Cluster方案达到负载均衡的目的。
3. 并且从另一方面讲，redis中sentinel有效的解决了故障转移的问题，也解决了主节点下线客户端无法识别新的可用节点的问题，
4. 但是如果是从节点下线了，sentinel是不会对其进行故障转移的，并且连接从节点的客户端也无法获取到新的可用从节点，
    而这些问题在Cluster中都得到了有效的解决。
    
### 集群方式的实现
1. 客户端分片: jedis, 使用一致性哈希
    - 优点:
        - 简单
        - 服务端的Redis实例彼此独立, 相互无关联
        - 每个redis 实例想单服务器一样运行, 统一线性扩展, 
    - 缺点
        - 由于 sharding 放在客户端, 规模进一步扩大时给运维带来压力
        - 不支持动态增删节点
        - 连接不能共享，当应用规模增大时，资源浪费制约优化。
2. 基于代理的分片: codis, Twemproxy
3. 路由查询: redis-cluster
    - 优点
        - 无中心架构，支持动态扩容，对业务透明
        - 具备Sentinel的监控和自动Failover能力
        - 客户端不需要连接集群所有节点,连接集群中任何一个可用节点即可
        - 高性能，客户端直连redis服务，免去了proxy代理的损耗
    - 缺点
        - 是运维也很复杂，
        - 数据迁移需要人工干预，
        - 只能使用0号数据库，
        - 不支持批量操作，
        - 分布式逻辑和存储模块耦合等。