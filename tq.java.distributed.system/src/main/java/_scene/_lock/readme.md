## 高并发下的分布式锁

### 场景 
1. 假如下单时，用分布式锁来防止库存超卖，但是是每秒上千订单的高并发场景，如何对分布式锁进行高并发优化来应对这个场景？
    - **在高并发场景下如何优化分布式锁的并发性能**。 
    - 悲观锁，分布式锁，乐观锁，队列串行化，异步队列分散，Redis原子操作
    - me
        - 1
            - 方案
                - redis
                - 参考分桶的想法, 将库存的量进行编号, 锁的数量和库存数量相同
                - 大量订单也分段, 分段数量和库存数量相同, 每一段去竞争同一把锁
                - 分流
            - 问题
                - 就是如果某个下单请求，咔嚓加锁，然后发现这个分段库存里的库存不足了，此时咋办？
                    - **自动释放锁, 换下一个分段库存, 再次尝试加锁获取** 
                - 实现很负载
                    - 数据分段存储
                    - 随机算法, 加锁哪个分段
                    - 分段数量不足, 自动切换到下一个分段
                 
    - other
        - 1 
            - redis
            - 同时只有一个客户单获取锁, 然后查询数据库, 扣除, 释放锁
            - 问题
                - 导致对同一个商品的下单请求，就必须串行化，一个接一个的处理。

2. 库存超卖就是用分布式锁来解决，而且一秒对一个iphone下上千订单，怎么优化
