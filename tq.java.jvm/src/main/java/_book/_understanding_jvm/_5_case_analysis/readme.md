2018-09-22

## 调优案例分析与实战

### 高性能硬件上的程序部署策略
1. 项目
    - 项目特点
        - 用户交互性强
        - 对停顿时间敏感
    - 流量
        - 15w PV/天
    - 服务器配置
        - 4-CPU, 16GB 物理内存, 64位 Centos5.4, Resin作为web服务器 
    - JVM
        - JDK1.5, -Xms12GB, -Xmx12GB
        - Server 模式
        - 默认使用吞吐量优先收集器
    - 问题
        - 网站经常不定期的出现长时间失去响应的情况
    - 产生原因
        - 由于GC导致: 一次 Full GC停顿时间高达 14 sec
        - 访问的磁盘文件需要加载到内存, 导致程序中有很多文档序列化产生的大对象, 大对象都进入了老年代
    - 在高性能硬件上部署程序, 两种方式
        - 通过64位JDK来使用大内存
            - 问题
                - 内存回收导致的长时间停顿
                - 需要保证程序足够稳定. 因为这类应用产生的堆转储快照因为太大无法进行分析
        - 部署若干个虚拟机建立逻辑集群来利用硬件资源
            - 负载均衡
                - 无 session复制的亲和式集群
                - **按照一定的规则算法(sessionid分配) 将一个固定的用户请求永远的分配到一个集群节点进行处理**
            - 问题
                - 尽量避免节点竞争全局资源, 比如 磁盘竞争
                - 很难高效率的利用某些资源的资源池
                    - 每个节点都有独立的连接池
                    - 可能会造成一个节点资源池满了, 一个节点还有多余
                - 大量使用本地缓存
                    - 本地缓存修改为 集中式缓存
                